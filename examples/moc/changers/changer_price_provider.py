from moneyonchain.manager import ConnectionManager
from moneyonchain.changers import MoCPriceProviderChanger

import logging
import logging.config

logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s %(name)-12s %(levelname)-8s %(message)s',
                    datefmt='%Y-%m-%d %H:%M:%S')
log = logging.getLogger('default')


network = 'mocTestnet'
connection_manager = ConnectionManager(network=network)
print("Connecting to %s..." % network)
print("Connected: {conectado}".format(conectado=connection_manager.is_connected))


contract = MoCPriceProviderChanger(connection_manager)
# BTC: 0x667bd3d048FaEBb85bAa0E9f9D87cF4c8CDFE849
# RIF: 0x9315AFD6aEc0bb1C1FB3fdcdC2E43797B0A61853
price_provider = '0x2d39Cc54dc44FF27aD23A91a9B5fd750dae4B218'
tx_hash, tx_receipt = contract.constructor(price_provider, execute_change=True)
if tx_receipt:
    print("Changer Contract Address: {address}".format(address=tx_receipt.contractAddress))
else:
    print("Error deploying changer")

"""

Connecting to mocTestnet...
2020-06-11 14:55:27 root         INFO     Deploying new contract...
Connected: True
2020-06-11 14:56:19 root         INFO     Deployed contract done!
2020-06-11 14:56:19 root         INFO     0x34bd9ddecfca4cf85c2979dcc53e3960dbc298ae6294f483b7adc34cb546258d
2020-06-11 14:56:19 root         INFO     AttributeDict({'transactionHash': HexBytes('0x34bd9ddecfca4cf85c2979dcc53e3960dbc298ae6294f483b7adc34cb546258d'), 'transactionIndex': 28, 'blockHash': HexBytes('0x84080e9e26b740f0edba09ec13d488283a1c0ef8548125beb989518dd4376dfe'), 'blockNumber': 924419, 'cumulativeGasUsed': 2098982, 'gasUsed': 420315, 'contractAddress': '0xCa867a7DCb47246d8a874E9A1c2712ab966e368b', 'logs': [AttributeDict({'logIndex': 0, 'blockNumber': 924419, 'blockHash': HexBytes('0x84080e9e26b740f0edba09ec13d488283a1c0ef8548125beb989518dd4376dfe'), 'transactionHash': HexBytes('0x34bd9ddecfca4cf85c2979dcc53e3960dbc298ae6294f483b7adc34cb546258d'), 'transactionIndex': 28, 'address': '0xCa867a7DCb47246d8a874E9A1c2712ab966e368b', 'data': '0x', 'topics': [HexBytes('0x8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0'), HexBytes('0x0000000000000000000000000000000000000000000000000000000000000000'), HexBytes('0x000000000000000000000000ab242e50e95c2f539242763a4ed5db1aee5ce461')]})], 'from': '0xaB242E50E95C2F539242763A4ed5DB1AEe5CE461', 'to': None, 'root': '0x01', 'status': 1, 'logsBloom': HexBytes('0x00000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000001000000000000000000000000000000000000020000000000000000000800000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000800000000000000000080004000000000000000000000000000000000000000000000000000000000000000000000000004000000000004000000000000000020000000000000000000000000000000000000000000000000000000000000000000')})
2020-06-11 14:56:19 root         INFO     Changer Contract Address: 0xCa867a7DCb47246d8a874E9A1c2712ab966e368b
Changer Contract Address: 0xCa867a7DCb47246d8a874E9A1c2712ab966e368b


2020-09-02 09:57:41 root         INFO     Deploying new contract...
Connected: True
2020-09-02 09:58:41 root         INFO     Deployed contract done!
2020-09-02 09:58:41 root         INFO     0x018fddec6976b60122e5e7edf525d86f49b15d6ada647c2a5762ea477b95057a
2020-09-02 09:58:41 root         INFO     AttributeDict({'transactionHash': HexBytes('0x018fddec6976b60122e5e7edf525d86f49b15d6ada647c2a5762ea477b95057a'), 'transactionIndex': 4, 'blockHash': HexBytes('0x2ea06c8f84e7891e80b27e23942fdf71669cff2b79451985eb74ba2bf94c74d7'), 'blockNumber': 1144835, 'cumulativeGasUsed': 572800, 'gasUsed': 420315, 'contractAddress': '0xB4B14bF5882689668d8DAeE26802A41389093F7A', 'logs': [AttributeDict({'logIndex': 0, 'blockNumber': 1144835, 'blockHash': HexBytes('0x2ea06c8f84e7891e80b27e23942fdf71669cff2b79451985eb74ba2bf94c74d7'), 'transactionHash': HexBytes('0x018fddec6976b60122e5e7edf525d86f49b15d6ada647c2a5762ea477b95057a'), 'transactionIndex': 4, 'address': '0xB4B14bF5882689668d8DAeE26802A41389093F7A', 'data': '0x', 'topics': [HexBytes('0x8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0'), HexBytes('0x0000000000000000000000000000000000000000000000000000000000000000'), HexBytes('0x000000000000000000000000ab242e50e95c2f539242763a4ed5db1aee5ce461')]})], 'from': '0xaB242E50E95C2F539242763A4ed5DB1AEe5CE461', 'to': None, 'root': '0x01', 'status': 1, 'logsBloom': HexBytes('0x00000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000008000000000000000000000100000000000000000000000000000000000000000000001000000000000000000000000000000000000020000000000000000000800000000000000000000000000000000400001000000000000000000000000000000000000000000000010000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000020000000000000000000000000000000000000000000000000000000000000000000')})
2020-09-02 09:58:41 root         INFO     Changer Contract Address: 0xB4B14bF5882689668d8DAeE26802A41389093F7A
2020-09-02 09:58:41 root         INFO     Executing change....
Changer Contract Address: None
2020-09-02 09:59:43 root         INFO     0x110036fe9408c4abd8770c0a65a94cbb9e27020534fc526b1bb10a265d22aa7b
2020-09-02 09:59:43 root         INFO     AttributeDict({'transactionHash': HexBytes('0x110036fe9408c4abd8770c0a65a94cbb9e27020534fc526b1bb10a265d22aa7b'), 'transactionIndex': 7, 'blockHash': HexBytes('0xbd969bc1b2b712f19316a5709737fc6aa0a5d5e9c50ddc5a5a395ddc97056707'), 'blockNumber': 1144837, 'cumulativeGasUsed': 308284, 'gasUsed': 59439, 'contractAddress': None, 'logs': [AttributeDict({'logIndex': 0, 'blockNumber': 1144837, 'blockHash': HexBytes('0xbd969bc1b2b712f19316a5709737fc6aa0a5d5e9c50ddc5a5a395ddc97056707'), 'transactionHash': HexBytes('0x110036fe9408c4abd8770c0a65a94cbb9e27020534fc526b1bb10a265d22aa7b'), 'transactionIndex': 7, 'address': '0xfb526c0Ace90f52049691389B040a33D03343eb7', 'data': '0x000000000000000000000000667bd3d048faebb85baa0e9f9d87cf4c8cdfe8490000000000000000000000002d39cc54dc44ff27ad23a91a9b5fd750dae4b218', 'topics': [HexBytes('0xf01c4ba47ffa16ddc86be088e27d891895d6944b4f1b88a7d30fedb0296de55c')]})], 'from': '0xaB242E50E95C2F539242763A4ed5DB1AEe5CE461', 'to': '0x9258531274B945eB628656F4b30e8216938A619C', 'root': '0x01', 'status': 1, 'logsBloom': HexBytes('0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000001000000000000000000000000000000000000000000000000000001000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000')})
2020-09-02 09:59:43 root         INFO     Change successfull!
"""